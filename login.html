<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="login.css">
<title>Login / Registratie</title>

</head>
<body>

 <header>
  <!--navigatie-->
  <ul class="nav">
    <li><a href="index.html">main parts</a></li>
    <li><a href="kappen.html">kappen </a></li>
    <li><a href="stuur.html">stuur</a></li>
    <li><a href="onderhoud.html">onderhoud</a></li>
    <li><a href="kleine-details.html">kleine details</a></li>
    <li><a href="fun.html">fun</a></li>
    <li><a href="contact.html">contact</a></li>
    <li><a class="active" href="login.html">Login</a></li>
    <li><a href="protected.html">protected</a></li>
  </ul>


  </header>

<h1>Login / Registratie</h1>

<form id="signup-form">
  <h2>Account Aanmaken</h2>
  <input id="signup-name" type="text" placeholder="Gebruikersnaam" required>
  <input id="signup-email" type="email" placeholder="Email" required>
  <input id="signup-pass" type="password" placeholder="Wachtwoord (min.6 tekens)" required minlength="6">
  <button type="submit">Registreren</button>
</form>

<form id="login-form">
  <h2>Inloggen</h2>
  <input id="login-email" type="email" placeholder="Email" required>
  <input id="login-pass" type="password" placeholder="Wachtwoord" required>
  <button type="submit">Inloggen</button>
  <br><br>
  <button type="button" id="reset-pass-btn">Wachtwoord vergeten?</button>
  <button type="button" id="check-verification">Controleer verificatie</button>
</form>

<div id="user-info" style="display:none;">
  <p id="welcome"></p>
  <p id="verify-warning" style="color:red; font-weight:bold;"></p>
  <button id="logout-btn">Uitloggen</button>
  <button id="go-protected" onclick="window.location.href='protected.html'">Ga naar protected pagina</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { 
  getAuth,
  createUserWithEmailAndPassword,
  updateProfile,
  signInWithEmailAndPassword,
  sendEmailVerification,
  sendPasswordResetEmail,
  signOut,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
  getFirestore,
  doc,
  setDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";


/* ðŸ”¥ JOUW FIREBASE CONFIG */
const firebaseConfig = {
   apiKey: "AIzaSyAh2nx8hk3VTqRIpIWvAOUYfEb_mIEb0-s",
   authDomain: "beta-site-21f67.firebaseapp.com",
   projectId: "beta-site-21f67",
   storageBucket: "beta-site-21f67.appspot.com",
   messagingSenderId: "316488809458",
   appId: "1:316488809458:web:b3c4540c7542e50871c96b",
   measurementId: "G-G1NVB3VYRD"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);


/* â­ REGISTRATIE */
signupForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = document.getElementById("signup-name").value;
  const email = document.getElementById("signup-email").value;
  const pass = document.getElementById("signup-pass").value;

  try {
    const cred = await createUserWithEmailAndPassword(auth, email, pass);

    await updateProfile(cred.user, { displayName: name });

    await setDoc(doc(db, "users", cred.user.uid), {
      name: name,
      email: email,
      createdAt: serverTimestamp()
    });

    await sendEmailVerification(cred.user);
    alert("Account aangemaakt! Check je inbox voor email verificatie.");
    signupForm.reset();

  } catch (err) {
    alert("Fout: " + err.message);
  }
});


/* â­ INLOGGEN */
loginForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  const email = document.getElementById("login-email").value;
  const pass = document.getElementById("login-pass").value;

  try {
    await signInWithEmailAndPassword(auth, email, pass);
    loginForm.reset();
  } catch (err) {
    alert("Inlog fout: " + err.message);
  }
});


/* â­ WACHTWOORD RESET */
resetPassBtn.addEventListener("click", async () => {
  const email = prompt("Voer je email in:");
  if (!email) return;

  try {
    await sendPasswordResetEmail(auth, email);
    alert("Wachtwoord reset e-mail verstuurd!");
  } catch (err) {
    alert("Fout: " + err.message);
  }
});


/* â­ VERIFICATIE CONTROLEREN */
checkVerificationBtn.addEventListener("click", async () => {
  const user = auth.currentUser;
  if (!user) return alert("Je bent niet ingelogd.");

  await user.reload();

  if (user.emailVerified) {
    alert("âœ” Je e-mail is succesvol geverifieerd!");
    location.reload();
  } else {
    alert("â— Je e-mail is nog niet geverifieerd. Check je inbox.");
  }
});


/* â­ USER STATE */
onAuthStateChanged(auth, async (user) => {
  if (user) {
    await user.reload();

    userInfo.style.display = "block";
    welcome.textContent = "Welkom, " + (user.displayName || user.email);

    verifyWarning.textContent = user.emailVerified
      ? ""
      : "âš  Gelieve je e-mail te verifiÃ«ren.";
  } 
  else {
    userInfo.style.display = "none";
    welcome.textContent = "";
    verifyWarning.textContent = "";
  }
});


/* â­ UITLOGGEN */
logoutBtn.addEventListener("click", async () => {
  await signOut(auth);
});
</script>



</body>
</html>
